/*! DataTables Bootstrap 3 integration
 * Â©2011-2015 SpryMedia Ltd - datatables.net/license
 */

/**
 * DataTables integration for Bootstrap 3. This requires Bootstrap 3 and
 * DataTables 1.10 or newer.
 *
 * This file sets the defaults and adds options to DataTables to style its
 * controls using Bootstrap. See http://datatables.net/manual/styling/bootstrap
 * for further information.
 */
(function( factory ){
	if ( typeof define === 'function' && define.amd ) {
		// AMD
		define( ['jquery', 'datatables.net'], function ( $ ) {
			return factory( $, window, document );
		} );
	}
	else if ( typeof exports === 'object' ) {
		// CommonJS
		module.exports = function (root, $) {
			if ( ! root ) {
				root = window;
			}

			if ( ! $ || ! $.fn.dataTable ) {
				// Require DataTables, which attaches to jQuery, including
				// jQuery if needed and have a $ property so we can access the
				// jQuery object that is used
				$ = require('datatables.net')(root, $).$;
			}

			return factory( $, root, root.document );
		};
	}
	else {
		// Browser
		factory( jQuery, window, document );
	}
}(function( $, window, document, undefined ) {
'use strict';
var DataTable = $.fn.dataTable;


/* Set the defaults for DataTables initialisation */
$.extend( true, DataTable.defaults, {
	dom:
		"<'dt-bootstrap-header'<'row'<'col-sm-6'l><'col-sm-6'f>>>" +
		"<'dt-bootstrap-body'<'row'<'col-sm-12'tr>>>" +
		"<'dt-bootstrap-footer'<'row'<'col-sm-5'i><'col-sm-7'p>>>",
	renderer: 'bootstrap'
} );


/* Default class modification */
$.extend( DataTable.ext.classes, {
	sWrapper:      "dataTables_wrapper form-inline dt-bootstrap",
	sFilterInput:  "form-control input-sm",
	sLengthSelect: "form-control input-sm",
	sProcessing:   "dataTables_processing panel panel-default"
} );


/* Bootstrap paging button renderer */
DataTable.ext.renderer.pageButton.bootstrap = function ( settings, host, idx, buttons, page, pages ) {
	var api     = new DataTable.Api( settings );
	var classes = settings.oClasses;
	var lang    = settings.oLanguage.oPaginate;
	var aria = settings.oLanguage.oAria.paginate || {};
	var btnDisplay, btnClass, counter=0;

	var attach = function( container, buttons ) {
		var i, ien, node, button;
		var clickHandler = function ( e ) {
			e.preventDefault();
			if ( !$(e.currentTarget).hasClass('disabled') && api.page() != e.data.action ) {
				api.page( e.data.action ).draw( 'page' );
			}
		};

		for ( i=0, ien=buttons.length ; i<ien ; i++ ) {
			button = buttons[i];

			if ( $.isArray( button ) ) {
				attach( container, button );
			}
			else {
				btnDisplay = '';
				btnClass = '';

				switch ( button ) {
					case 'ellipsis':
						btnDisplay = '&#x2026;';
						btnClass = 'disabled';
						break;

					case 'first':
						btnDisplay = lang.sFirst;
						btnClass = button + (page > 0 ?
							'' : ' disabled');
						break;

					case 'previous':
						btnDisplay = lang.sPrevious;
						btnClass = button + (page > 0 ?
							'' : ' disabled');
						break;

					case 'next':
						btnDisplay = lang.sNext;
						btnClass = button + (page < pages-1 ?
							'' : ' disabled');
						break;

					case 'last':
						btnDisplay = lang.sLast;
						btnClass = button + (page < pages-1 ?
							'' : ' disabled');
						break;

					default:
						btnDisplay = button + 1;
						btnClass = page === button ?
							'active' : '';
						break;
				}

				if ( btnDisplay ) {
					node = $('<li>', {
							'class': classes.sPageButton+' '+btnClass,
							'id': idx === 0 && typeof button === 'string' ?
								settings.sTableId +'_'+ button :
								null
						} )
						.append( $('<a>', {
								'href': '#',
								'aria-controls': settings.sTableId,
								'aria-label': aria[ button ],
								'data-dt-idx': counter,
								'tabindex': settings.iTabIndex
							} )
							.html( btnDisplay )
						)
						.appendTo( container );

					settings.oApi._fnBindAction(
						node, {action: button}, clickHandler
					);

					counter++;
				}
			}
		}
	};

	// IE9 throws an 'unknown error' if document.activeElement is used
	// inside an iframe or frame. 
	var activeEl;

	try {
		// Because this approach is destroying and recreating the paging
		// elements, focus is lost on the select button which is bad for
		// accessibility. So we want to restore focus once the draw has
		// completed
		activeEl = $(host).find(document.activeElement).data('dt-idx');
	}
	catch (e) {}

	attach(
		$(host).empty().html('<ul class="pagination"/>').children('ul'),
		buttons
	);

	if ( activeEl ) {
		$(host).find( '[data-dt-idx='+activeEl+']' ).focus();
	}
};


return DataTable;
}));
$(function () {
    $.fn.dataTable.ext.errMode = function () {
        window.Admin.Messages.error(window.Admin.Settings.lang.table.error);
    };

    $.fn.dataTable.ext.order['DateTime'] = function (settings, col) {
        return this.api().column(col, {order: 'index'}).nodes().map(function (td, i) {
            return $(td).data('value');
        });
    }

    $('.datatables').each(function () {
        var $this = $(this),
            id = $this.data('id');

        var params = $this.data('attributes');

        var url;
        if (url = $this.data('url')) {
            params.serverSide = true;
            params.processing = true;
            params.ajax = {
                url: url,
                data: function (d) {
                    $('[data-datatables-id="' + id + '"] .column-filter').each(function () {
                        var $this = $(this);
                        var index = $this.closest('td').data('index');
                        if (name = $this.data('ajax-data-name')) {
                            d.columns[index]['search'][name] = $this.val();
                        }
                    });
                }
            };
        }

        var table = $this.DataTable(params);

        $('[data-datatables-id="' + id + '"] .column-filter').each(function () {
            var $this = $(this),
                type = $this.data('type'),
                index = $this.closest('td').data('index');

            if (typeof window.columnFilters[type] == 'function') {
                window.columnFilters[type](this, table, table.column(index), index);
            }
        });
    });
});

window.columnFilters = {
    range: function (container, table, column, index) {
        var $container = $(container);

        var $input = $container.find('input');

        var from = $input.filter(':first');
        var to = $input.filter(':last');

        from.data('ajax-data-name', 'from');
        to.data('ajax-data-name', 'to');

        $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
            if (table.settings()[0].sTableId != settings.sTableId) {
                return true;
            }

            var value = table.data()[dataIndex][index];
            if (value && value['@data-order'] !== undefined) {
                value = value['@data-order'];
            }

            var fromValue = from.val();
            var toValue = to.val();

            if ((from.closest('.input-date').length > 0) && (to.closest('.input-date').length > 0)) {
                if (fromValue != '') {
                    fromValue = from.closest('.input-date').data('DateTimePicker').date();
                } else {
                    fromValue = Number.NEGATIVE_INFINITY;
                }

                if (toValue != '') {
                    toValue = to.closest('.input-date').data('DateTimePicker').date();
                } else {
                    toValue = Number.POSITIVE_INFINITY;
                }

                value = moment(value);
            } else {
                value = parseInt(value);
                fromValue = parseInt(fromValue);
                toValue = parseInt(toValue);
            }

            if (( isNaN(fromValue) && isNaN(toValue) ) ||
                ( isNaN(fromValue) && value <= toValue ) ||
                ( fromValue <= value && isNaN(toValue) ) ||
                ( fromValue <= value && value <= toValue )) {
                return true;
            }

            return false;
        });

        $input.on('keyup change dp.change', function () {
            table.draw();
        });
    },
    select: function (input, table, column, index) {
        var $input = $(input);

        $input.on('change', function () {
            var val = $input.val() ? $input.find(':selected').text() : '';
            column.search(val).draw();
        });
    },
    text: function (input, table, column, index) {
        var $input = $(input);

        $input.on('keyup change', function () {
            column.search($input.val()).draw();
        });
    }
}
//# sourceMappingURL=datatables.min.js.map
